# Basado en el escenario 1
1.) Aceptar el tráfico ping entre la red 2.20.200.0/24 y el server WWWSRV66.
El resto de tráfico no mencionado deberá estar prohibido.

# FWs afectados: FW55

# Limpiando configuraciones previas.
iptables -t filter -F INPUT
iptables -t filter -F OUTPUT
iptables -t filter -F FORWARD

# Estableciendo una política por defecto
# Politica DROP
iptables -t filter -P INPUT DROP
iptables -t filter -P OUTPUT DROP
iptables -t filter -P FORWARD DROP

# Flujo de IDA: Aceptando tráfico PING desde la Red 2.20.200/24 al WWWSRV66
iptables -A FORWARD -p icmp -s 2.20.200.0/24 -d 2.22.222.66 -j ACCEPT
# Suponiendo que la 2.20.200.55 fuese la eth0 y la 2.22.222.55 fuese la eth1,
la regla podría quedar:
iptables -A FORWARD -p icmp -i eth0 -o eth1 -j ACCEPT

# Flujo de VUELTA: Aceptando tráfico PING desde el WWWSRV66 a la Red 2.20.200/24
iptables -A FORWARD -p icmp -s 2.22.222.66 -d 2.20.200.0/24 -j ACCEPT
# Suponiendo que la 2.20.200.55 fuese la eth0 y la 2.22.222.55 fuese la eth1,
la regla podría quedar:
iptables -A FORWARD -p icmp -i eth1 -o eth0 -j ACCEPT

# Suponiendo que FW55 puede hacer PING al WWWSRV66
# Flujo de IDA: Aceptando tráfico PING desde FW55 al WWWSRV66
iptables -A OUTPUT -p icmp -d 2.22.22.66 -j ACCEPT

# Flujo de VUELTA: Aceptando tráfico PING desde el WWWSRV66 ald FW55
iptables -A INPUT -p icmp -s 2.22.22.66 -j ACCEPT

2). Prohibir tráfico ssh de wwsrv22 desde y hacia red delta.
El resto debe estar permitido

# FWs Implicados: FW44

# Limpiando configuraciones previas.
iptables -t filter -F INPUT
iptables -t filter -F OUTPUT
iptables -t filter -F FORWARD

# Estableciendo una política por defecto
# Politica ACCEPT
iptables -t filter -P INPUT ACCEPT
iptables -t filter -P OUTPUT ACCEPT
iptables -t filter -P FORWARD ACCEPT

# TRAFICO IDA:Prohibiendo trafico SSH desde la red 2.20.200.0/24 (NO FW44) hacia WWWSRV22[2222]
iptables -A FORWARD -p tcp --dport 2222 -s 2.20.200.0/24 -d 1.11.111.22 -j DROP
# TRAFICO VUELTA
iptables -A FORWARD -p tcp --sport 2222 -s 1.11.111.22 -d 2.20.200.0/24 -j DROP

# Prohibiendo trafico SSH desde el FW44 hacia el WWWSRV22[2222]
iptables -A OUTPUT -p tcp --dport 2222 -d 1.11.111.22 -j DROP

# Prohibiendo trafico SSH desde el WWWSRV22[2222] hacia el FW44
iptables -A OUTPUT -p tcp --sport 2222 -s 1.11.111.22 -j DROP

3). Decidir qué FW es necesario programar para que la máquina EST01 no pueda visitar el portal web que hay ubicado en la máquina srv22 en el puerto 8022. Se supone que EST01 conoce el puerto. Además en la red delta, existe un DNS que sabe donde está el servidor srv22. El resto del tráfico no mencionado deberá estar aceptado.

# Limpiando configuraciones previas.
iptables -t filter -F INPUT
iptables -t filter -F OUTPUT
iptables -t filter -F FORWARD

# Estableciendo una política por defecto
# Politica ACCEPT
iptables -t filter -P INPUT ACCEPT
iptables -t filter -P OUTPUT ACCEPT
iptables -t filter -P FORWARD ACCEPT

# Tráfico IDA: PROHIBIR http[8022] desde EST01 hacia SRV22.
iptables -A FORWARD -s 2.20.200.33 -d 1.11.111.22 -p tcp --dport 8022 -j DROP
# Tráfico VUELTA: PROHIBIR EST01 hacia SRV22 hacia http[8022].
iptables -A FORWARD -d 2.20.200.33 -s 1.11.111.22 -p tcp --sport 8022 -j DROP

4.) El Fw44 es el único que puede visitar el portal web del fw55. Tanto para el fw44 como para el fw55, todo el tráfico no mencionado deberá estar prohibido. Se supone que fw44 conoce el puerto htpp del servidor. Además, existirá un DNS en la red delta.org.

# Enfocándolo desde el FW44
# Limpiando configuraciones previas.
iptables -t filter -F INPUT
iptables -t filter -F OUTPUT
iptables -t filter -F FORWARD

# Estableciendo una política por defecto
# Politica DROP
iptables -t filter -P INPUT DROP
iptables -t filter -P OUTPUT DROP
iptables -t filter -P FORWARD DROP

# Tráfico HTTP desde el FW44 y dirigido al puerto 8055 del FW55
# IDA
iptables -A OUTPUT -p tcp --dport 8055 -d 2.20.200.55 -j ACCEPT
# VUELTA
iptables -A INPUT -p tcp --sport 8055 -s 2.20.200.44 -j ACCEPT

# Enfocándolo desde el FW55
# Limpiando configuraciones previas.
iptables -t filter -F INPUT
iptables -t filter -F OUTPUT
iptables -t filter -F FORWARD

# Estableciendo una política por defecto
# Politica DROP
iptables -t filter -P INPUT DROP
iptables -t filter -P OUTPUT DROP
iptables -t filter -P FORWARD DROP

# Tráfico HTTP desde el FW44 y dirigido al puerto 8055 del FW55
# IDA
iptables -A INPUT -p tcp --dport 8055 -s 2.20.200.44 -j ACCEPT
# VUELTA
iptables -A OUTPUT -p tcp --sport 8055 -d 2.20.200.55 -j ACCEPT 


5). Ningún equipo de la red sigma y la red delta puede hacer ping al FW55. Todo el tráfico no mencionado deberá estar aceptado. Realizar el ejercicio con el FW44 en lugar del FW55.
# EL FIREWALL AFECTADO: FW55

# Limpiando configuraciones previas.
iptables -t filter -F INPUT
iptables -t filter -F OUTPUT
iptables -t filter -F FORWARD

# Estableciendo una política por defecto
# Politica ACCEPT
iptables -t filter -P INPUT ACCEPT
iptables -t filter -P OUTPUT ACCEPT
iptables -t filter -P FORWARD ACCEPT

# IDA: Prohibir Tráfico PING desde Red Sigma a FW55 [Asumiendo que el FW55 no pertenece a Red Sigma]
iptables -A INPUT -p icmp -s 2.22.222.0/24 -j DROP
# Vuelta: Prohibir Tráfico PING desde Fw55 a Red Sigma [No es necesaria]
iptables -A OUTPUT -p icmp -d 2.22.222.0/24 -j DROP

# IDA: FW55 con FW55 [Ping a sí mismo] [[ ESTOS DOS NO HARíAN FALTA FINALMENTE YA QUE VAN INCLUIDOS EN LOS OTROS ]]
#iptables -A INPUT -p icmp -s 2.20.200.55 -j DROP
#iptables -A INPUT -p icmp -s 2.22.222.55 -j DROP
#iptables -A INPUT -p icmp -s 127.0.0.1 -j DROP
# Vuelta:
#iptables -A OUTPUT -p icmp -d 2.20.200.55 -j DROP
#iptables -A OUTPUT -p icmp -d 2.22.222.55 -j DROP
#iptables -A OUTPUT -p icmp -d 127.0.0.1 -j DROP

# IDA: Prohibir Tráfico PING desde Red Delta a FW55 [Asumiendo que el FW55 no pertenece a Red Delta]
iptables -A INPUT -p icmp -s 2.20.200.0/24 -j DROP
# Vuelta: Prohibir Tráfico PING desde Fw55 a Red Delta [No es necesaria]
iptables -A OUTPUT -p icmp -d 2.20.200.0/24 -j DROP

6). Ningún equipo de la red sigma y la red delta puede hacer ping al FW44. Todo el tráfico no mencionado deberá estar aceptado.

# Firewall Afectado: FW55
# Limpiando configuraciones previas.
iptables -t filter -F INPUT
iptables -t filter -F OUTPUT
iptables -t filter -F FORWARD

# Estableciendo una política por defecto
# Politica ACCEPT
iptables -t filter -P INPUT ACCEPT
iptables -t filter -P OUTPUT ACCEPT
iptables -t filter -P FORWARD ACCEPT

# IDA: Tráfico desde la red Sigma(no FW55) al FW44
iptables -A FORWARD -s 2.22.222.0/24 -d 2.20.200.44 -p icmp -j DROP
# VUELTA: Tráfico desde el FW44 a red Sigma
iptables -A FORWARD -s 2.20.200.44 -d 2.22.222.0/24 -pc icmp -j DROP

# IDA: FW55 al FW44
iptables -A OUTPUT -p icmp -d 2.20.200.44 -j DROP
# VUELTA: FW44 al FW55
iptables -A INPUT -p icmp -s 2.20.200.44 -j DROP

# Firewall Afectado: FW44
# Limpiando configuraciones previas.
iptables -t filter -F INPUT
iptables -t filter -F OUTPUT
iptables -t filter -F FORWARD

# Estableciendo una política por defecto
# Politica ACCEPT
iptables -t filter -P INPUT ACCEPT
iptables -t filter -P OUTPUT ACCEPT
iptables -t filter -P FORWARD ACCEPT

# IDA: Tráfico desde la red Delta(no FW55) al FW44
iptables -A INPUT -s 2.20.200.0/24 -p icmp -j DROP
# VUELTA: Tráfico desde el FW44 a red Delta
iptables -A OUTPUT -d 2.20.200.44 -pc icmp -j DROP
